import{S as Ie,i as Pe,s as be,k as A,q as S,a as U,l as v,m as y,r as x,h as E,c as M,n as h,b as z,G as i,I as N,B as me,J as Le,o as Ne,K as W,L as ae,u as oe,M as Ce}from"../../chunks/index-9a6ba6fc.js";const H={INVALID:0,SIN:1,ADD:2,SUB:3,MUL:4,DIV:5,POW:6,MOD:7,IF:8,EQ:9,GT:10,LT:11,AND:12,OR:13,VAL:14,VAR_T:15,VAR_I:16,END:17},De=H,Se=e=>e.split("").map((t,r)=>t==="("?{type:"OPEN_PARAN",rawValue:t,index:r}:t===")"?{type:"CLOSE_PARAN",rawValue:t,index:r}:t===" "?{type:"WHITESPACE",rawValue:t,index:r}:t==="+"?{type:"OPERATOR",operator:"ADD",rawValue:t,index:r}:t==="-"?{type:"OPERATOR",operator:"SUB",rawValue:t,index:r}:t==="*"?{type:"OPERATOR",operator:"MUL",rawValue:t,index:r}:t==="/"?{type:"OPERATOR",operator:"DIV",rawValue:t,index:r}:t==="%"?{type:"OPERATOR",operator:"MOD",rawValue:t,index:r}:t==="^"?{type:"OPERATOR",operator:"POW",rawValue:t,index:r}:t===">"?{type:"OPERATOR",operator:"GT",rawValue:t,index:r}:t==="<"?{type:"OPERATOR",operator:"LT",rawValue:t,index:r}:t==="="?{type:"OPERATOR",operator:"EQ",rawValue:t,index:r}:t===","?{type:"OPERATOR",operator:"SEP",rawValue:t,index:r}:t==="&"?{type:"OPERATOR",operator:"AND",rawValue:t,index:r}:t==="|"?{type:"OPERATOR",operator:"OR",rawValue:t,index:r}:{type:"LITERAL",value:t,rawValue:t,index:r}),Ee=[["SEP"],["AND","OR"],["GT","LT","EQ"],["MOD"],["ADD","SUB"],["DIV","MUL"]];class J extends Error{constructor(t,r){super(t),this.index=r}}const X=(e,t)=>{if(e.length===0)throw new J("Expected an expression",t);for(let a=0;a<Ee.length;a++){const p=Ee[a];let d=0;for(let m=0;m<e.length;m++){const o=e[m];if(o.type==="OPEN_PARAN"&&(d+=1),o.type==="CLOSE_PARAN"&&(d-=1),o.type==="OPERATOR"&&d==0&&p.includes(o.operator))return{type:"operator",op:o.operator,a:X(e.slice(0,m),e[0].index+1),b:X(e.slice(m+1),o.index+1),index:o.index}}}let r="",l=-1;for(let a=0;a<e.length;a++){const p=e[a];if(p.type==="LITERAL"&&(r+=p.value,l===-1&&(l=p.index)),p.type==="OPEN_PARAN"){if(e.slice(-1)[0].type!=="CLOSE_PARAN")throw new J("Unmatched opening parenthesis",p.index);if(r){const d=X(e.slice(a+1,-1),p.index),m=[],o=u=>{u.type==="operator"&&u.op==="SEP"?(o(u.a),o(u.b)):m.push(u)};return o(d),{type:"call",name:r,args:m,index:l}}else return X(e.slice(a+1,-1),p.index)}}const _=e.find(a=>a.type!=="LITERAL");if(_)throw new J(`Unexpected token: ${_.rawValue}`,_.index);return r=e.map(a=>a.value).join(""),isNaN(parseInt(r,10))?{type:"variable",name:r,index:e[0].index}:{type:"value",val:parseInt(r,10),index:e[0].index}},F=e=>{if(e.type==="call"){if(e.name==="if")return[...F(e.args[0]),...F(e.args[1]),...F(e.args[2]),H.IF];if(e.name==="sin")return[...F(e.args[0]),H.SIN];throw new J(`Invalid function: ${e.name}`,e.index)}else if(e.type==="operator"){const t=De[e.op];if(t===void 0)throw new J(`Invalid operator: ${e.op}`,e.index);return[...F(e.a),...F(e.b),t]}else{if(e.type==="value")return[H.VAL,e.val];if(e.type==="variable"){if(e.name==="i")return[H.VAR_I];if(e.name==="t")return[H.VAR_T];throw new J(`Unknown variable: ${e.name}`,e.index)}else throw new Error("INVALID TYPE")}},Ue=e=>{try{const t=Se(e),r=X(t.filter(_=>_.type!=="WHITESPACE"),0);return{compiled:F(r)}}catch(t){if(t instanceof J)return{error:`Error: ${t.message}
    ${e}
    ${" ".repeat(t.index)}^`,errorRaw:t};throw t}};function ge(e,t,r){const l=e.slice();return l[16]=t[r],l[17]=t,l[18]=r,l}function Ae(e){let t,r,l,_,a,p,d,m,o,u,s,g=e[16].h.error+"",f,P,D,B,j,O,n,c,R=e[16].s.error+"",L,Q,C,V,I,b,q,Y,K=e[16].v.error+"",Z,$,k,ee,te,se;function ve(){e[5].call(l,e[17],e[18])}function we(){e[6].call(o,e[17],e[18])}function ye(){e[7].call(O,e[17],e[18])}function Oe(){e[8].call(b,e[17],e[18])}function Re(){return e[9](e[16])}function Te(){e[10].call(t,e[17],e[18])}function Ve(){return e[11](e[16],e[17],e[18])}return{c(){t=A("details"),r=A("summary"),l=A("input"),_=U(),a=A("div"),p=A("div"),d=A("label"),m=S("h = "),o=A("input"),u=U(),s=A("pre"),f=S(g),P=U(),D=A("div"),B=A("label"),j=S("s = "),O=A("input"),n=U(),c=A("pre"),L=S(R),Q=U(),C=A("div"),V=A("label"),I=S("v = "),b=A("input"),q=U(),Y=A("pre"),Z=S(K),$=U(),k=A("button"),ee=S("Delete"),this.h()},l(G){t=v(G,"DETAILS",{class:!0});var w=y(t);r=v(w,"SUMMARY",{});var ie=y(r);l=v(ie,"INPUT",{type:!0,class:!0}),ie.forEach(E),_=M(w),a=v(w,"DIV",{class:!0});var T=y(a);p=v(T,"DIV",{class:!0});var ne=y(p);d=v(ne,"LABEL",{for:!0});var ue=y(d);m=x(ue,"h = "),ue.forEach(E),o=v(ne,"INPUT",{name:!0,class:!0,type:!0}),ne.forEach(E),u=M(T),s=v(T,"PRE",{});var pe=y(s);f=x(pe,g),pe.forEach(E),P=M(T),D=v(T,"DIV",{class:!0});var re=y(D);B=v(re,"LABEL",{for:!0});var fe=y(B);j=x(fe,"s = "),fe.forEach(E),O=v(re,"INPUT",{name:!0,class:!0,type:!0}),re.forEach(E),n=M(T),c=v(T,"PRE",{});var ce=y(c);L=x(ce,R),ce.forEach(E),Q=M(T),C=v(T,"DIV",{class:!0});var le=y(C);V=v(le,"LABEL",{for:!0});var he=y(V);I=x(he,"v = "),he.forEach(E),b=v(le,"INPUT",{name:!0,class:!0,type:!0}),le.forEach(E),q=M(T),Y=v(T,"PRE",{});var de=y(Y);Z=x(de,K),de.forEach(E),$=M(T),k=v(T,"BUTTON",{class:!0});var _e=y(k);ee=x(_e,"Delete"),_e.forEach(E),T.forEach(E),w.forEach(E),this.h()},h(){h(l,"type","text"),h(l,"class","focus:outline-none font-mono"),h(d,"for","h"),h(o,"name","h"),h(o,"class","pl-4 font-mono focus:outline-none"),h(o,"type","text"),h(p,"class","flex whitespace-nowrap"),h(B,"for","s"),h(O,"name","s"),h(O,"class","pl-4 font-mono focus:outline-none"),h(O,"type","text"),h(D,"class","flex whitespace-nowrap"),h(V,"for","v"),h(b,"name","v"),h(b,"class","pl-4 font-mono focus:outline-none"),h(b,"type","text"),h(C,"class","flex whitespace-nowrap"),h(k,"class","mt-4"),h(a,"class","pl-10"),h(t,"class","pl-10 py-5 font-mono text-2xl")},m(G,w){z(G,t,w),i(t,r),i(r,l),W(l,e[16].name),i(t,_),i(t,a),i(a,p),i(p,d),i(d,m),i(p,o),W(o,e[16].h.value),i(a,u),i(a,s),i(s,f),i(a,P),i(a,D),i(D,B),i(B,j),i(D,O),W(O,e[16].s.value),i(a,n),i(a,c),i(c,L),i(a,Q),i(a,C),i(C,V),i(V,I),i(C,b),W(b,e[16].v.value),i(a,q),i(a,Y),i(Y,Z),i(a,$),i(a,k),i(k,ee),t.open=e[16].open,te||(se=[N(l,"input",ve),N(o,"input",we),N(o,"input",function(){ae(e[16].h.onChange)&&e[16].h.onChange.apply(this,arguments)}),N(O,"input",ye),N(O,"input",function(){ae(e[16].s.onChange)&&e[16].s.onChange.apply(this,arguments)}),N(b,"input",Oe),N(b,"input",function(){ae(e[16].v.onChange)&&e[16].v.onChange.apply(this,arguments)}),N(k,"click",Re),N(t,"toggle",Te),N(t,"click",Ve)],te=!0)},p(G,w){e=G,w&1&&l.value!==e[16].name&&W(l,e[16].name),w&1&&o.value!==e[16].h.value&&W(o,e[16].h.value),w&1&&g!==(g=e[16].h.error+"")&&oe(f,g),w&1&&O.value!==e[16].s.value&&W(O,e[16].s.value),w&1&&R!==(R=e[16].s.error+"")&&oe(L,R),w&1&&b.value!==e[16].v.value&&W(b,e[16].v.value),w&1&&K!==(K=e[16].v.error+"")&&oe(Z,K),w&1&&(t.open=e[16].open)},d(G){G&&E(t),te=!1,Ce(se)}}}function xe(e){let t,r,l,_,a,p,d,m,o=e[0],u=[];for(let s=0;s<o.length;s+=1)u[s]=Ae(ge(e,o,s));return{c(){t=A("h1"),r=S("LEDS"),l=U();for(let s=0;s<u.length;s+=1)u[s].c();_=U(),a=A("button"),p=S("Add equation"),this.h()},l(s){t=v(s,"H1",{class:!0});var g=y(t);r=x(g,"LEDS"),g.forEach(E),l=M(s);for(let P=0;P<u.length;P+=1)u[P].l(s);_=M(s),a=v(s,"BUTTON",{class:!0});var f=y(a);p=x(f,"Add equation"),f.forEach(E),this.h()},h(){h(t,"class","text-5xl"),h(a,"class","text-2xl")},m(s,g){z(s,t,g),i(t,r),z(s,l,g);for(let f=0;f<u.length;f+=1)u[f].m(s,g);z(s,_,g),z(s,a,g),i(a,p),d||(m=N(a,"click",e[2]),d=!0)},p(s,[g]){if(g&11){o=s[0];let f;for(f=0;f<o.length;f+=1){const P=ge(s,o,f);u[f]?u[f].p(P,g):(u[f]=Ae(P),u[f].c(),u[f].m(_.parentNode,_))}for(;f<u.length;f+=1)u[f].d(1);u.length=o.length}},i:me,o:me,d(s){s&&E(t),s&&E(l),Le(u,s),s&&E(_),s&&E(a),d=!1,m()}}}function Me(e,t,r){let l=[],_=!1,a=!1;Ne(()=>{window.location.protocol==="https:"&&(window.location.protocol="http:"),r(0,l=JSON.parse(localStorage.getItem("equations")||"[]")),l.forEach(n=>{n.h.onChange=o(n.h,n),n.s.onChange=o(n.s,n),n.v.onChange=o(n.v,n),n.h.onChange(),n.s.onChange(),n.v.onChange()}),a=!0,r(4,_=!0)});let p=!1,d;const m=(n,c=!0)=>{if(!a||n.h.error||n.s.error||n.v.error)return;p&&(d&&clearInterval(d),d=setInterval(()=>{p||(m(n,c),clearInterval(d))},1));const R=new Uint32Array(n.h.compiledValue),L=new Uint32Array(n.s.compiledValue),Q=new Uint32Array(n.v.compiledValue),C=new Uint32Array([+c]),V=new Uint32Array([H.END,0]),I=new WebSocket("ws://home.anb.codes:13655");p=!0,I.addEventListener("open",()=>{console.log("Sending..."),I.send(C.buffer),console.log(C),I.send(R.buffer),console.log(R),I.send(V.buffer),console.log(V),I.send(L.buffer),console.log(L),I.send(V.buffer),console.log(V),I.send(Q.buffer),console.log(Q),I.send(V.buffer),console.log(V)}),I.addEventListener("close",()=>{p=!1,console.log("closed")})},o=(n,c)=>()=>{const R=Ue(n.value);R.error?n.error=R.error:(n.error="",n.compiledValue=R.compiled),m(c),r(0,l)},u=()=>{const n={h:{value:"",compiledValue:[],onChange:()=>{},error:""},s:{value:"",compiledValue:[],onChange:()=>{},error:""},v:{value:"",compiledValue:[],onChange:()=>{},error:""},name:"New Equation",open:!0};n.h.onChange=o(n.h,n),n.s.onChange=o(n.s,n),n.v.onChange=o(n.v,n),n.h.onChange(),n.s.onChange(),n.v.onChange(),l.forEach(c=>c.open=!1),l.push(n),r(0,l)},s=n=>{r(0,l=l.filter(c=>c!==n))};function g(n,c){n[c].name=this.value,r(0,l)}function f(n,c){n[c].h.value=this.value,r(0,l)}function P(n,c){n[c].s.value=this.value,r(0,l)}function D(n,c){n[c].v.value=this.value,r(0,l)}const B=n=>s(n);function j(n,c){n[c].open=this.open,r(0,l)}const O=(n,c,R)=>{console.log(l),n.open||(m(n),l.filter(L=>L!==n).forEach(L=>L.open=!1),setTimeout(()=>r(0,c[R].open=!0,l),0),r(0,l))};return e.$$.update=()=>{e.$$.dirty&17&&_&&localStorage.setItem("equations",JSON.stringify(l))},[l,m,u,s,_,g,f,P,D,B,j,O]}class We extends Ie{constructor(t){super(),Pe(this,t,Me,xe,be,{})}}export{We as default};
