import{S as Ie,i as Pe,s as be,k as m,q as U,a as x,l as E,m as R,r as k,h as w,c as M,n as u,b as ve,G as s,I as C,B as _e,J as Le,o as De,K as B,L as ae,u as le,M as Ne}from"../../chunks/index-9a6ba6fc.js";const F={INVALID:0,SIN:1,ADD:2,SUB:3,MUL:4,DIV:5,POW:6,MOD:7,IF:8,EQ:9,GT:10,LT:11,AND:12,OR:13,VAL:14,VAR_T:15,VAR_I:16,END:17},Ce=F,Se=e=>e.split("").map((t,n)=>t==="("?{type:"OPEN_PARAN",rawValue:t,index:n}:t===")"?{type:"CLOSE_PARAN",rawValue:t,index:n}:t===" "?{type:"WHITESPACE",rawValue:t,index:n}:t==="+"?{type:"OPERATOR",operator:"ADD",rawValue:t,index:n}:t==="-"?{type:"OPERATOR",operator:"SUB",rawValue:t,index:n}:t==="*"?{type:"OPERATOR",operator:"MUL",rawValue:t,index:n}:t==="/"?{type:"OPERATOR",operator:"DIV",rawValue:t,index:n}:t==="%"?{type:"OPERATOR",operator:"MOD",rawValue:t,index:n}:t==="^"?{type:"OPERATOR",operator:"POW",rawValue:t,index:n}:t===">"?{type:"OPERATOR",operator:"GT",rawValue:t,index:n}:t==="<"?{type:"OPERATOR",operator:"LT",rawValue:t,index:n}:t==="="?{type:"OPERATOR",operator:"EQ",rawValue:t,index:n}:t===","?{type:"OPERATOR",operator:"SEP",rawValue:t,index:n}:t==="&"?{type:"OPERATOR",operator:"AND",rawValue:t,index:n}:t==="|"?{type:"OPERATOR",operator:"OR",rawValue:t,index:n}:{type:"LITERAL",value:t,rawValue:t,index:n}),me=[["SEP"],["AND","OR"],["GT","LT","EQ"],["MOD"],["ADD","SUB"],["DIV","MUL"]];class H extends Error{constructor(t,n){super(t),this.index=n}}const K=(e,t)=>{if(e.length===0)throw new H("Expected an expression",t);for(let l=0;l<me.length;l++){const i=me[l];let d=0;for(let _=0;_<e.length;_++){const o=e[_];if(o.type==="OPEN_PARAN"&&(d+=1),o.type==="CLOSE_PARAN"&&(d-=1),o.type==="OPERATOR"&&d==0&&i.includes(o.operator))return{type:"operator",op:o.operator,a:K(e.slice(0,_),e[0].index+1),b:K(e.slice(_+1),o.index+1),index:o.index}}}let n="",a=-1;for(let l=0;l<e.length;l++){const i=e[l];if(i.type==="LITERAL"&&(n+=i.value,a===-1&&(a=i.index)),i.type==="OPEN_PARAN"){if(e.slice(-1)[0].type!=="CLOSE_PARAN")throw new H("Unmatched opening parenthesis",i.index);if(n){const d=K(e.slice(l+1,-1),i.index),_=[],o=g=>{g.type==="operator"&&g.op==="SEP"?(o(g.a),o(g.b)):_.push(g)};return o(d),{type:"call",name:n,args:_,index:a}}else return K(e.slice(l+1,-1),i.index)}}const y=e.find(l=>l.type!=="LITERAL");if(y)throw new H(`Unexpected token: ${y.rawValue}`,y.index);return n=e.map(l=>l.value).join(""),isNaN(parseInt(n,10))?{type:"variable",name:n,index:e[0].index}:{type:"value",val:parseInt(n,10),index:e[0].index}},G=e=>{if(e.type==="call"){if(e.name==="if")return[...G(e.args[0]),...G(e.args[1]),...G(e.args[2]),F.IF];if(e.name==="sin")return[...G(e.args[0]),F.SIN];throw new H(`Invalid function: ${e.name}`,e.index)}else if(e.type==="operator"){const t=Ce[e.op];if(t===void 0)throw new H(`Invalid operator: ${e.op}`,e.index);return[...G(e.a),...G(e.b),t]}else{if(e.type==="value")return[F.VAL,e.val];if(e.type==="variable"){if(e.name==="i")return[F.VAR_I];if(e.name==="t")return[F.VAR_T];throw new H(`Unknown variable: ${e.name}`,e.index)}else throw new Error("INVALID TYPE")}},Ue=e=>{try{const t=Se(e),n=K(t.filter(y=>y.type!=="WHITESPACE"),0);return{compiled:G(n)}}catch(t){if(t instanceof H)return{error:`Error: ${t.message}
    ${e}
    ${" ".repeat(t.index)}^`,errorRaw:t};throw t}};function Ee(e,t,n){const a=e.slice();return a[16]=t[n],a[17]=t,a[18]=n,a}function ge(e){let t,n,a,y,l,i,d,_,o,g,f,p=e[16].h.error+"",v,h,T,D,Q,A,r,c,I=e[16].s.error+"",N,J,S,b,L,O,Z,j,Y=e[16].v.error+"",X,q,z,$,ee,oe;function Ae(){e[5].call(a,e[17],e[18])}function we(){e[6].call(o,e[17],e[18])}function ye(){e[7].call(A,e[17],e[18])}function Oe(){e[8].call(O,e[17],e[18])}function Re(){return e[9](e[16])}function Te(){e[10].call(t,e[17],e[18])}function Ve(){return e[11](e[16],e[17],e[18])}return{c(){t=m("details"),n=m("summary"),a=m("input"),y=x(),l=m("div"),i=m("div"),d=m("label"),_=U("h = "),o=m("input"),g=x(),f=m("pre"),v=U(p),h=x(),T=m("div"),D=m("label"),Q=U("s = "),A=m("input"),r=x(),c=m("pre"),N=U(I),J=x(),S=m("div"),b=m("label"),L=U("v = "),O=m("input"),Z=x(),j=m("pre"),X=U(Y),q=x(),z=m("button"),$=U("Delete"),this.h()},l(W){t=E(W,"DETAILS",{class:!0});var V=R(t);n=E(V,"SUMMARY",{});var se=R(n);a=E(se,"INPUT",{type:!0,class:!0}),se.forEach(w),y=M(V),l=E(V,"DIV",{class:!0});var P=R(l);i=E(P,"DIV",{class:!0});var te=R(i);d=E(te,"LABEL",{for:!0});var ue=R(d);_=k(ue,"h = "),ue.forEach(w),o=E(te,"INPUT",{name:!0,class:!0,type:!0,autocomplete:!0,autocorrect:!0,autocapitalize:!0,spellcheck:!0}),te.forEach(w),g=M(P),f=E(P,"PRE",{});var ie=R(f);v=k(ie,p),ie.forEach(w),h=M(P),T=E(P,"DIV",{class:!0});var re=R(T);D=E(re,"LABEL",{for:!0});var pe=R(D);Q=k(pe,"s = "),pe.forEach(w),A=E(re,"INPUT",{name:!0,class:!0,type:!0,autocomplete:!0,autocorrect:!0,autocapitalize:!0,spellcheck:!0}),re.forEach(w),r=M(P),c=E(P,"PRE",{});var ce=R(c);N=k(ce,I),ce.forEach(w),J=M(P),S=E(P,"DIV",{class:!0});var ne=R(S);b=E(ne,"LABEL",{for:!0});var fe=R(b);L=k(fe,"v = "),fe.forEach(w),O=E(ne,"INPUT",{name:!0,class:!0,type:!0,autocomplete:!0,autocorrect:!0,autocapitalize:!0,spellcheck:!0}),ne.forEach(w),Z=M(P),j=E(P,"PRE",{});var he=R(j);X=k(he,Y),he.forEach(w),q=M(P),z=E(P,"BUTTON",{class:!0});var de=R(z);$=k(de,"Delete"),de.forEach(w),P.forEach(w),V.forEach(w),this.h()},h(){u(a,"type","text"),u(a,"class","focus:outline-none font-mono"),u(d,"for","h"),u(o,"name","h"),u(o,"class","pl-4 font-mono focus:outline-none"),u(o,"type","text"),u(o,"autocomplete","off"),u(o,"autocorrect","off"),u(o,"autocapitalize","off"),u(o,"spellcheck","false"),u(i,"class","flex whitespace-nowrap"),u(D,"for","s"),u(A,"name","s"),u(A,"class","pl-4 font-mono focus:outline-none"),u(A,"type","text"),u(A,"autocomplete","off"),u(A,"autocorrect","off"),u(A,"autocapitalize","off"),u(A,"spellcheck","false"),u(T,"class","flex whitespace-nowrap"),u(b,"for","v"),u(O,"name","v"),u(O,"class","pl-4 font-mono focus:outline-none"),u(O,"type","text"),u(O,"autocomplete","off"),u(O,"autocorrect","off"),u(O,"autocapitalize","off"),u(O,"spellcheck","false"),u(S,"class","flex whitespace-nowrap"),u(z,"class","mt-4"),u(l,"class","pl-10"),u(t,"class","pl-10 py-5 font-mono text-xl")},m(W,V){ve(W,t,V),s(t,n),s(n,a),B(a,e[16].name),s(t,y),s(t,l),s(l,i),s(i,d),s(d,_),s(i,o),B(o,e[16].h.value),s(l,g),s(l,f),s(f,v),s(l,h),s(l,T),s(T,D),s(D,Q),s(T,A),B(A,e[16].s.value),s(l,r),s(l,c),s(c,N),s(l,J),s(l,S),s(S,b),s(b,L),s(S,O),B(O,e[16].v.value),s(l,Z),s(l,j),s(j,X),s(l,q),s(l,z),s(z,$),t.open=e[16].open,ee||(oe=[C(a,"input",Ae),C(o,"input",we),C(o,"input",function(){ae(e[16].h.onChange)&&e[16].h.onChange.apply(this,arguments)}),C(A,"input",ye),C(A,"input",function(){ae(e[16].s.onChange)&&e[16].s.onChange.apply(this,arguments)}),C(O,"input",Oe),C(O,"input",function(){ae(e[16].v.onChange)&&e[16].v.onChange.apply(this,arguments)}),C(z,"click",Re),C(t,"toggle",Te),C(t,"click",Ve)],ee=!0)},p(W,V){e=W,V&1&&a.value!==e[16].name&&B(a,e[16].name),V&1&&o.value!==e[16].h.value&&B(o,e[16].h.value),V&1&&p!==(p=e[16].h.error+"")&&le(v,p),V&1&&A.value!==e[16].s.value&&B(A,e[16].s.value),V&1&&I!==(I=e[16].s.error+"")&&le(N,I),V&1&&O.value!==e[16].v.value&&B(O,e[16].v.value),V&1&&Y!==(Y=e[16].v.error+"")&&le(X,Y),V&1&&(t.open=e[16].open)},d(W){W&&w(t),ee=!1,Ne(oe)}}}function xe(e){let t,n,a,y,l,i,d,_,o,g=e[0],f=[];for(let p=0;p<g.length;p+=1)f[p]=ge(Ee(e,g,p));return{c(){t=m("div"),n=m("h1"),a=U("LEDS"),y=x();for(let p=0;p<f.length;p+=1)f[p].c();l=x(),i=m("button"),d=U("Add equation"),this.h()},l(p){t=E(p,"DIV",{class:!0});var v=R(t);n=E(v,"H1",{class:!0});var h=R(n);a=k(h,"LEDS"),h.forEach(w),y=M(v);for(let D=0;D<f.length;D+=1)f[D].l(v);l=M(v),i=E(v,"BUTTON",{class:!0});var T=R(i);d=k(T,"Add equation"),T.forEach(w),v.forEach(w),this.h()},h(){u(n,"class","text-5xl"),u(i,"class","text-2xl"),u(t,"class","p-4")},m(p,v){ve(p,t,v),s(t,n),s(n,a),s(t,y);for(let h=0;h<f.length;h+=1)f[h].m(t,null);s(t,l),s(t,i),s(i,d),_||(o=C(i,"click",e[2]),_=!0)},p(p,[v]){if(v&11){g=p[0];let h;for(h=0;h<g.length;h+=1){const T=Ee(p,g,h);f[h]?f[h].p(T,v):(f[h]=ge(T),f[h].c(),f[h].m(t,l))}for(;h<f.length;h+=1)f[h].d(1);f.length=g.length}},i:_e,o:_e,d(p){p&&w(t),Le(f,p),_=!1,o()}}}function ke(e,t,n){let a=[],y=!1,l=!1;De(()=>{window.location.protocol==="https:"&&(window.location.protocol="http:"),n(0,a=JSON.parse(localStorage.getItem("equations")||"[]")),a.forEach(r=>{r.h.onChange=o(r.h,r),r.s.onChange=o(r.s,r),r.v.onChange=o(r.v,r),r.h.onChange(),r.s.onChange(),r.v.onChange()}),l=!0,n(4,y=!0)});let i=!1,d;const _=(r,c=!0)=>{if(!l||r.h.error||r.s.error||r.v.error)return;i&&(d&&clearInterval(d),d=setInterval(()=>{i||(_(r,c),clearInterval(d))},1));const I=new Uint32Array(r.h.compiledValue),N=new Uint32Array(r.s.compiledValue),J=new Uint32Array(r.v.compiledValue),S=new Uint32Array([+c]),b=new Uint32Array([F.END,0]),L=new WebSocket("ws://home.anb.codes:13655");i=!0,L.addEventListener("open",()=>{console.log("Sending..."),L.send(S.buffer),console.log(S),L.send(I.buffer),console.log(I),L.send(b.buffer),console.log(b),L.send(N.buffer),console.log(N),L.send(b.buffer),console.log(b),L.send(J.buffer),console.log(J),L.send(b.buffer),console.log(b)}),L.addEventListener("close",()=>{i=!1,console.log("closed")})},o=(r,c)=>()=>{const I=Ue(r.value);I.error?r.error=I.error:(r.error="",r.compiledValue=I.compiled),_(c),n(0,a)},g=()=>{const r={h:{value:"",compiledValue:[],onChange:()=>{},error:""},s:{value:"",compiledValue:[],onChange:()=>{},error:""},v:{value:"",compiledValue:[],onChange:()=>{},error:""},name:"New Equation",open:!0};r.h.onChange=o(r.h,r),r.s.onChange=o(r.s,r),r.v.onChange=o(r.v,r),r.h.onChange(),r.s.onChange(),r.v.onChange(),a.forEach(c=>c.open=!1),a.push(r),n(0,a)},f=r=>{n(0,a=a.filter(c=>c!==r))};function p(r,c){r[c].name=this.value,n(0,a)}function v(r,c){r[c].h.value=this.value,n(0,a)}function h(r,c){r[c].s.value=this.value,n(0,a)}function T(r,c){r[c].v.value=this.value,n(0,a)}const D=r=>f(r);function Q(r,c){r[c].open=this.open,n(0,a)}const A=(r,c,I)=>{console.log(a),r.open||(_(r),a.filter(N=>N!==r).forEach(N=>N.open=!1),setTimeout(()=>n(0,c[I].open=!0,a),0),n(0,a))};return e.$$.update=()=>{e.$$.dirty&17&&y&&localStorage.setItem("equations",JSON.stringify(a))},[a,_,g,f,y,p,v,h,T,D,Q,A]}class Be extends Ie{constructor(t){super(),Pe(this,t,ke,xe,be,{})}}export{Be as default};
