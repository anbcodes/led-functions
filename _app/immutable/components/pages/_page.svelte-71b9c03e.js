import{S as Pe,i as be,s as Le,k as m,q as U,a as x,l as E,m as w,r as k,h as v,c as B,n as i,b as ve,G as o,I as L,B as _e,J as De,K as Ae,o as Ne,L as W,M as le,u as ae}from"../../chunks/index-4a8f3127.js";const J={INVALID:0,SIN:1,ADD:2,SUB:3,MUL:4,DIV:5,POW:6,MOD:7,IF:8,EQ:9,GT:10,LT:11,AND:12,OR:13,VAL:14,VAR_T:15,VAR_I:16,END:17},Ce=J,Se=e=>e.split("").map((t,n)=>t==="("?{type:"OPEN_PARAN",rawValue:t,index:n}:t===")"?{type:"CLOSE_PARAN",rawValue:t,index:n}:t===" "?{type:"WHITESPACE",rawValue:t,index:n}:t==="+"?{type:"OPERATOR",operator:"ADD",rawValue:t,index:n}:t==="-"?{type:"OPERATOR",operator:"SUB",rawValue:t,index:n}:t==="*"?{type:"OPERATOR",operator:"MUL",rawValue:t,index:n}:t==="/"?{type:"OPERATOR",operator:"DIV",rawValue:t,index:n}:t==="%"?{type:"OPERATOR",operator:"MOD",rawValue:t,index:n}:t==="^"?{type:"OPERATOR",operator:"POW",rawValue:t,index:n}:t===">"?{type:"OPERATOR",operator:"GT",rawValue:t,index:n}:t==="<"?{type:"OPERATOR",operator:"LT",rawValue:t,index:n}:t==="="?{type:"OPERATOR",operator:"EQ",rawValue:t,index:n}:t===","?{type:"OPERATOR",operator:"SEP",rawValue:t,index:n}:t==="&"?{type:"OPERATOR",operator:"AND",rawValue:t,index:n}:t==="|"?{type:"OPERATOR",operator:"OR",rawValue:t,index:n}:{type:"LITERAL",value:t,rawValue:t,index:n}),me=[["SEP"],["AND","OR"],["GT","LT","EQ"],["MOD"],["ADD","SUB"],["DIV","MUL"]];class Q extends Error{constructor(t,n){super(t),this.index=n}}const K=(e,t)=>{if(e.length===0)throw new Q("Expected an expression",t);for(let a=0;a<me.length;a++){const c=me[a];let _=0;for(let g=0;g<e.length;g++){const s=e[g];if(s.type==="OPEN_PARAN"&&(_+=1),s.type==="CLOSE_PARAN"&&(_-=1),s.type==="OPERATOR"&&_==0&&c.includes(s.operator))return{type:"operator",op:s.operator,a:K(e.slice(0,g),e[0].index+1),b:K(e.slice(g+1),s.index+1),index:s.index}}}let n="",l=-1;for(let a=0;a<e.length;a++){const c=e[a];if(c.type==="LITERAL"&&(n+=c.value,l===-1&&(l=c.index)),c.type==="OPEN_PARAN"){if(e.slice(-1)[0].type!=="CLOSE_PARAN")throw new Q("Unmatched opening parenthesis",c.index);if(n){const _=K(e.slice(a+1,-1),c.index),g=[],s=A=>{A.type==="operator"&&A.op==="SEP"?(s(A.a),s(A.b)):g.push(A)};return s(_),{type:"call",name:n,args:g,index:l}}else return K(e.slice(a+1,-1),c.index)}}const y=e.find(a=>a.type!=="LITERAL");if(y)throw new Q(`Unexpected token: ${y.rawValue}`,y.index);return n=e.map(a=>a.value).join(""),isNaN(parseInt(n,10))?{type:"variable",name:n,index:e[0].index}:{type:"value",val:parseInt(n,10),index:e[0].index}},H=e=>{if(e.type==="call"){if(e.name==="if")return[...H(e.args[0]),...H(e.args[1]),...H(e.args[2]),J.IF];if(e.name==="sin")return[...H(e.args[0]),J.SIN];throw new Q(`Invalid function: ${e.name}`,e.index)}else if(e.type==="operator"){const t=Ce[e.op];if(t===void 0)throw new Q(`Invalid operator: ${e.op}`,e.index);return[...H(e.a),...H(e.b),t]}else{if(e.type==="value")return[J.VAL,e.val];if(e.type==="variable"){if(e.name==="i")return[J.VAR_I];if(e.name==="t")return[J.VAR_T];throw new Q(`Unknown variable: ${e.name}`,e.index)}else throw new Error("INVALID TYPE")}},Ue=e=>{try{const t=Se(e),n=K(t.filter(y=>y.type!=="WHITESPACE"),0);return{compiled:H(n)}}catch(t){if(t instanceof Q)return{error:`Error: ${t.message}
    ${e}
    ${" ".repeat(t.index)}^`,errorRaw:t};throw t}};function Ee(e,t,n){const l=e.slice();return l[17]=t[n],l[18]=t,l[19]=n,l}function ge(e){let t,n,l,y,a,c,_,g,s,A,P,D=e[17].h.error+"",M,b,h,f,R,u,I,r,p=e[17].s.error+"",O,N,C,z,S,d,Z,j,Y=e[17].v.error+"",X,q,G,$,ee,oe;function we(){e[5].call(l,e[18],e[19])}function ye(){e[6].call(s,e[18],e[19])}function Re(){e[7].call(u,e[18],e[19])}function Oe(){e[8].call(d,e[18],e[19])}function Te(){return e[9](e[17])}function Ve(){e[10].call(t,e[18],e[19])}function Ie(){return e[11](e[17],e[18],e[19])}return{c(){t=m("details"),n=m("summary"),l=m("input"),y=x(),a=m("div"),c=m("div"),_=m("label"),g=U("h = "),s=m("input"),A=x(),P=m("pre"),M=U(D),b=x(),h=m("div"),f=m("label"),R=U("s = "),u=m("input"),I=x(),r=m("pre"),O=U(p),N=x(),C=m("div"),z=m("label"),S=U("v = "),d=m("input"),Z=x(),j=m("pre"),X=U(Y),q=x(),G=m("button"),$=U("Delete"),this.h()},l(F){t=E(F,"DETAILS",{class:!0});var T=w(t);n=E(T,"SUMMARY",{});var se=w(n);l=E(se,"INPUT",{type:!0,class:!0}),se.forEach(v),y=B(T),a=E(T,"DIV",{class:!0});var V=w(a);c=E(V,"DIV",{class:!0});var te=w(c);_=E(te,"LABEL",{for:!0});var ue=w(_);g=k(ue,"h = "),ue.forEach(v),s=E(te,"INPUT",{name:!0,class:!0,type:!0,autocomplete:!0,autocorrect:!0,autocapitalize:!0,spellcheck:!0}),te.forEach(v),A=B(V),P=E(V,"PRE",{});var ie=w(P);M=k(ie,D),ie.forEach(v),b=B(V),h=E(V,"DIV",{class:!0});var re=w(h);f=E(re,"LABEL",{for:!0});var ce=w(f);R=k(ce,"s = "),ce.forEach(v),u=E(re,"INPUT",{name:!0,class:!0,type:!0,autocomplete:!0,autocorrect:!0,autocapitalize:!0,spellcheck:!0}),re.forEach(v),I=B(V),r=E(V,"PRE",{});var pe=w(r);O=k(pe,p),pe.forEach(v),N=B(V),C=E(V,"DIV",{class:!0});var ne=w(C);z=E(ne,"LABEL",{for:!0});var fe=w(z);S=k(fe,"v = "),fe.forEach(v),d=E(ne,"INPUT",{name:!0,class:!0,type:!0,autocomplete:!0,autocorrect:!0,autocapitalize:!0,spellcheck:!0}),ne.forEach(v),Z=B(V),j=E(V,"PRE",{});var he=w(j);X=k(he,Y),he.forEach(v),q=B(V),G=E(V,"BUTTON",{class:!0});var de=w(G);$=k(de,"Delete"),de.forEach(v),V.forEach(v),T.forEach(v),this.h()},h(){i(l,"type","text"),i(l,"class","focus:outline-none font-mono"),i(_,"for","h"),i(s,"name","h"),i(s,"class","pl-4 font-mono focus:outline-none"),i(s,"type","text"),i(s,"autocomplete","off"),i(s,"autocorrect","off"),i(s,"autocapitalize","off"),i(s,"spellcheck","false"),i(c,"class","flex whitespace-nowrap"),i(f,"for","s"),i(u,"name","s"),i(u,"class","pl-4 font-mono focus:outline-none"),i(u,"type","text"),i(u,"autocomplete","off"),i(u,"autocorrect","off"),i(u,"autocapitalize","off"),i(u,"spellcheck","false"),i(h,"class","flex whitespace-nowrap"),i(z,"for","v"),i(d,"name","v"),i(d,"class","pl-4 font-mono focus:outline-none"),i(d,"type","text"),i(d,"autocomplete","off"),i(d,"autocorrect","off"),i(d,"autocapitalize","off"),i(d,"spellcheck","false"),i(C,"class","flex whitespace-nowrap"),i(G,"class","mt-4"),i(a,"class","pl-10"),i(t,"class","pl-10 py-5 font-mono text-xl")},m(F,T){ve(F,t,T),o(t,n),o(n,l),W(l,e[17].name),o(t,y),o(t,a),o(a,c),o(c,_),o(_,g),o(c,s),W(s,e[17].h.value),o(a,A),o(a,P),o(P,M),o(a,b),o(a,h),o(h,f),o(f,R),o(h,u),W(u,e[17].s.value),o(a,I),o(a,r),o(r,O),o(a,N),o(a,C),o(C,z),o(z,S),o(C,d),W(d,e[17].v.value),o(a,Z),o(a,j),o(j,X),o(a,q),o(a,G),o(G,$),t.open=e[17].open,ee||(oe=[L(l,"input",we),L(s,"input",ye),L(s,"input",function(){le(e[17].h.onChange)&&e[17].h.onChange.apply(this,arguments)}),L(u,"input",Re),L(u,"input",function(){le(e[17].s.onChange)&&e[17].s.onChange.apply(this,arguments)}),L(d,"input",Oe),L(d,"input",function(){le(e[17].v.onChange)&&e[17].v.onChange.apply(this,arguments)}),L(G,"click",Te),L(t,"toggle",Ve),L(t,"click",Ie)],ee=!0)},p(F,T){e=F,T&1&&l.value!==e[17].name&&W(l,e[17].name),T&1&&s.value!==e[17].h.value&&W(s,e[17].h.value),T&1&&D!==(D=e[17].h.error+"")&&ae(M,D),T&1&&u.value!==e[17].s.value&&W(u,e[17].s.value),T&1&&p!==(p=e[17].s.error+"")&&ae(O,p),T&1&&d.value!==e[17].v.value&&W(d,e[17].v.value),T&1&&Y!==(Y=e[17].v.error+"")&&ae(X,Y),T&1&&(t.open=e[17].open)},d(F){F&&v(t),ee=!1,Ae(oe)}}}function xe(e){let t,n,l,y,a,c,_,g,s,A,P,D,M,b=e[0],h=[];for(let f=0;f<b.length;f+=1)h[f]=ge(Ee(e,b,f));return{c(){t=m("div"),n=m("h1"),l=U("LEDS"),y=x();for(let f=0;f<h.length;f+=1)h[f].c();a=x(),c=m("div"),_=m("button"),g=U("Add equation"),s=x(),A=m("button"),P=U("Reload"),this.h()},l(f){t=E(f,"DIV",{class:!0});var R=w(t);n=E(R,"H1",{class:!0});var u=w(n);l=k(u,"LEDS"),u.forEach(v),y=B(R);for(let O=0;O<h.length;O+=1)h[O].l(R);a=B(R),c=E(R,"DIV",{class:!0});var I=w(c);_=E(I,"BUTTON",{class:!0});var r=w(_);g=k(r,"Add equation"),r.forEach(v),s=B(I),A=E(I,"BUTTON",{class:!0});var p=w(A);P=k(p,"Reload"),p.forEach(v),I.forEach(v),R.forEach(v),this.h()},h(){i(n,"class","text-5xl"),i(_,"class","text-2xl"),i(A,"class","text-2xl mt-6"),i(c,"class","flex flex-col"),i(t,"class","p-4")},m(f,R){ve(f,t,R),o(t,n),o(n,l),o(t,y);for(let u=0;u<h.length;u+=1)h[u].m(t,null);o(t,a),o(t,c),o(c,_),o(_,g),o(c,s),o(c,A),o(A,P),D||(M=[L(_,"click",e[2]),L(A,"click",e[12])],D=!0)},p(f,[R]){if(R&11){b=f[0];let u;for(u=0;u<b.length;u+=1){const I=Ee(f,b,u);h[u]?h[u].p(I,R):(h[u]=ge(I),h[u].c(),h[u].m(t,a))}for(;u<h.length;u+=1)h[u].d(1);h.length=b.length}},i:_e,o:_e,d(f){f&&v(t),De(h,f),D=!1,Ae(M)}}}function ke(e,t,n){let l=[],y=!1,a=!1;Ne(()=>{window.location.protocol==="https:"&&(window.location.protocol="http:"),n(0,l=JSON.parse(localStorage.getItem("equations")||"[]")),l.forEach(r=>{r.h.onChange=s(r.h,r),r.s.onChange=s(r.s,r),r.v.onChange=s(r.v,r),r.h.onChange(),r.s.onChange(),r.v.onChange()}),a=!0,n(4,y=!0)});let c=!1,_;const g=(r,p=!0)=>{if(!a||r.h.error||r.s.error||r.v.error)return;c&&(_&&clearInterval(_),_=setInterval(()=>{c||(g(r,p),clearInterval(_))},1));const O=new Uint32Array(r.h.compiledValue),N=new Uint32Array(r.s.compiledValue),C=new Uint32Array(r.v.compiledValue),z=new Uint32Array([+p]),S=new Uint32Array([J.END,0]),d=new WebSocket("ws://home.anb.codes:13655");c=!0,d.addEventListener("open",()=>{console.log("Sending..."),d.send(z.buffer),console.log(z),d.send(O.buffer),console.log(O),d.send(S.buffer),console.log(S),d.send(N.buffer),console.log(N),d.send(S.buffer),console.log(S),d.send(C.buffer),console.log(C),d.send(S.buffer),console.log(S)}),d.addEventListener("close",()=>{c=!1,console.log("closed")})},s=(r,p)=>()=>{const O=Ue(r.value);O.error?r.error=O.error:(r.error="",r.compiledValue=O.compiled),g(p),n(0,l)},A=()=>{const r={h:{value:"",compiledValue:[],onChange:()=>{},error:""},s:{value:"",compiledValue:[],onChange:()=>{},error:""},v:{value:"",compiledValue:[],onChange:()=>{},error:""},name:"New Equation",open:!0};r.h.onChange=s(r.h,r),r.s.onChange=s(r.s,r),r.v.onChange=s(r.v,r),r.h.onChange(),r.s.onChange(),r.v.onChange(),l.forEach(p=>p.open=!1),l.push(r),n(0,l)},P=r=>{n(0,l=l.filter(p=>p!==r))};function D(r,p){r[p].name=this.value,n(0,l)}function M(r,p){r[p].h.value=this.value,n(0,l)}function b(r,p){r[p].s.value=this.value,n(0,l)}function h(r,p){r[p].v.value=this.value,n(0,l)}const f=r=>P(r);function R(r,p){r[p].open=this.open,n(0,l)}const u=(r,p,O)=>{console.log(l),r.open||(g(r),l.filter(N=>N!==r).forEach(N=>N.open=!1),setTimeout(()=>n(0,p[O].open=!0,l),0),n(0,l))},I=()=>location.reload();return e.$$.update=()=>{e.$$.dirty&17&&y&&localStorage.setItem("equations",JSON.stringify(l))},[l,g,A,P,y,D,M,b,h,f,R,u,I]}class Me extends Pe{constructor(t){super(),be(this,t,ke,xe,Le,{})}}export{Me as default};
