import{S as Oe,i as Re,s as ve,k as y,q as S,a as C,l as O,m as b,r as D,h as A,c as U,n as g,b as Y,G as p,I as L,B as pe,J as we,o as Te,K as M,L as $,u as ee,M as Pe}from"../../chunks/index-9a6ba6fc.js";const k={INVALID:0,SIN:1,ADD:2,SUB:3,MUL:4,DIV:5,POW:6,MOD:7,IF:8,EQ:9,GT:10,LT:11,AND:12,OR:13,VAL:14,VAR_T:15,VAR_I:16,END:17},Ve=k,Ie=e=>e.split("").map((t,r)=>t==="("?{type:"OPEN_PARAN",rawValue:t,index:r}:t===")"?{type:"CLOSE_PARAN",rawValue:t,index:r}:t===" "?{type:"WHITESPACE",rawValue:t,index:r}:t==="+"?{type:"OPERATOR",operator:"ADD",rawValue:t,index:r}:t==="-"?{type:"OPERATOR",operator:"SUB",rawValue:t,index:r}:t==="*"?{type:"OPERATOR",operator:"MUL",rawValue:t,index:r}:t==="/"?{type:"OPERATOR",operator:"DIV",rawValue:t,index:r}:t==="%"?{type:"OPERATOR",operator:"MOD",rawValue:t,index:r}:t==="^"?{type:"OPERATOR",operator:"POW",rawValue:t,index:r}:t===">"?{type:"OPERATOR",operator:"GT",rawValue:t,index:r}:t==="<"?{type:"OPERATOR",operator:"LT",rawValue:t,index:r}:t==="="?{type:"OPERATOR",operator:"EQ",rawValue:t,index:r}:t===","?{type:"OPERATOR",operator:"SEP",rawValue:t,index:r}:t==="&"?{type:"OPERATOR",operator:"AND",rawValue:t,index:r}:t==="|"?{type:"OPERATOR",operator:"OR",rawValue:t,index:r}:{type:"LITERAL",value:t,rawValue:t,index:r}),fe=[["SEP"],["AND","OR"],["GT","LT","EQ"],["MOD"],["ADD","SUB"],["DIV","MUL"]];class G extends Error{constructor(t,r){super(t),this.index=r}}const K=(e,t)=>{if(e.length===0)throw new G("Expected an expression",t);for(let l=0;l<fe.length;l++){const f=fe[l];let _=0;for(let i=0;i<e.length;i++){const u=e[i];if(u.type==="OPEN_PARAN"&&(_+=1),u.type==="CLOSE_PARAN"&&(_-=1),u.type==="OPERATOR"&&_==0&&f.includes(u.operator))return{type:"operator",op:u.operator,a:K(e.slice(0,i),e[0].index+1),b:K(e.slice(i+1),u.index+1),index:u.index}}}let r="",a=-1;for(let l=0;l<e.length;l++){const f=e[l];if(f.type==="LITERAL"&&(r+=f.value,a===-1&&(a=f.index)),f.type==="OPEN_PARAN"){if(e.slice(-1)[0].type!=="CLOSE_PARAN")throw new G("Unmatched opening parenthesis",f.index);if(r){const _=K(e.slice(l+1,-1),f.index),i=[],u=s=>{s.type==="operator"&&s.op==="SEP"?(u(s.a),u(s.b)):i.push(s)};return u(_),{type:"call",name:r,args:i,index:a}}else return K(e.slice(l+1,-1),f.index)}}const d=e.find(l=>l.type!=="LITERAL");if(d)throw new G(`Unexpected token: ${d.rawValue}`,d.index);return r=e.map(l=>l.value).join(""),isNaN(parseInt(r,10))?{type:"variable",name:r,index:e[0].index}:{type:"value",val:parseInt(r,10),index:e[0].index}},W=e=>{if(e.type==="call"){if(e.name==="if")return[...W(e.args[0]),...W(e.args[1]),...W(e.args[2]),k.IF];if(e.name==="sin")return[...W(e.args[0]),k.SIN];throw new G(`Invalid function: ${e.name}`,e.index)}else if(e.type==="operator"){const t=Ve[e.op];if(t===void 0)throw new G(`Invalid operator: ${e.op}`,e.index);return[...W(e.a),...W(e.b),t]}else{if(e.type==="value")return[k.VAL,e.val];if(e.type==="variable"){if(e.name==="i")return[k.VAR_I];if(e.name==="t")return[k.VAR_T];throw new G(`Unknown variable: ${e.name}`,e.index)}else throw new Error("INVALID TYPE")}},be=e=>{try{const t=Ie(e),r=K(t.filter(d=>d.type!=="WHITESPACE"),0);return{compiled:W(r)}}catch(t){if(t instanceof G)return{error:`Error: ${t.message}
    ${e}
    ${" ".repeat(t.index)}^`,errorRaw:t};throw t}};function ce(e,t,r){const a=e.slice();return a[16]=t[r],a[17]=t,a[18]=r,a}function he(e){let t,r,a,d,l,f,_,i,u,s,o=e[16].h.error+"",m,c,R,J,P,Q,x,n=e[16].s.error+"",h,I,V,F,v,N,w,j=e[16].v.error+"",z,X,H,Z,q,te;function de(){e[5].call(a,e[17],e[18])}function _e(){e[6].call(i,e[17],e[18])}function me(){e[7].call(P,e[17],e[18])}function Ee(){e[8].call(v,e[17],e[18])}function ge(){return e[9](e[16])}function Ae(){e[10].call(t,e[17],e[18])}function ye(){return e[11](e[16],e[17],e[18])}return{c(){t=y("details"),r=y("summary"),a=y("input"),d=C(),l=y("div"),f=y("label"),_=S("h = "),i=y("input"),u=C(),s=y("pre"),m=S(o),c=C(),R=y("label"),J=S("s = "),P=y("input"),Q=C(),x=y("pre"),h=S(n),I=C(),V=y("label"),F=S("v = "),v=y("input"),N=C(),w=y("pre"),z=S(j),X=C(),H=y("button"),Z=S("Delete"),this.h()},l(B){t=O(B,"DETAILS",{class:!0});var T=b(t);r=O(T,"SUMMARY",{});var ne=b(r);a=O(ne,"INPUT",{type:!0}),ne.forEach(A),d=U(T),l=O(T,"DIV",{class:!0});var E=b(l);f=O(E,"LABEL",{for:!0});var re=b(f);_=D(re,"h = "),re.forEach(A),i=O(E,"INPUT",{name:!0,class:!0,type:!0}),u=U(E),s=O(E,"PRE",{});var le=b(s);m=D(le,o),le.forEach(A),c=U(E),R=O(E,"LABEL",{for:!0});var ae=b(R);J=D(ae,"s = "),ae.forEach(A),P=O(E,"INPUT",{name:!0,class:!0,type:!0}),Q=U(E),x=O(E,"PRE",{});var oe=b(x);h=D(oe,n),oe.forEach(A),I=U(E),V=O(E,"LABEL",{for:!0});var se=b(V);F=D(se,"v = "),se.forEach(A),v=O(E,"INPUT",{name:!0,class:!0,type:!0}),N=U(E),w=O(E,"PRE",{});var ie=b(w);z=D(ie,j),ie.forEach(A),X=U(E),H=O(E,"BUTTON",{});var ue=b(H);Z=D(ue,"Delete"),ue.forEach(A),E.forEach(A),T.forEach(A),this.h()},h(){g(a,"type","text"),g(f,"for","h"),g(i,"name","h"),g(i,"class","font-mono focus:outline-none"),g(i,"type","text"),g(R,"for","s"),g(P,"name","s"),g(P,"class","font-mono focus:outline-none"),g(P,"type","text"),g(V,"for","v"),g(v,"name","v"),g(v,"class","font-mono focus:outline-none"),g(v,"type","text"),g(l,"class","pl-10"),g(t,"class","pl-10 py-5 font-mono text-2xl")},m(B,T){Y(B,t,T),p(t,r),p(r,a),M(a,e[16].name),p(t,d),p(t,l),p(l,f),p(f,_),p(l,i),M(i,e[16].h.value),p(l,u),p(l,s),p(s,m),p(l,c),p(l,R),p(R,J),p(l,P),M(P,e[16].s.value),p(l,Q),p(l,x),p(x,h),p(l,I),p(l,V),p(V,F),p(l,v),M(v,e[16].v.value),p(l,N),p(l,w),p(w,z),p(l,X),p(l,H),p(H,Z),t.open=e[16].open,q||(te=[L(a,"input",de),L(i,"input",_e),L(i,"input",function(){$(e[16].h.onChange)&&e[16].h.onChange.apply(this,arguments)}),L(P,"input",me),L(P,"input",function(){$(e[16].s.onChange)&&e[16].s.onChange.apply(this,arguments)}),L(v,"input",Ee),L(v,"input",function(){$(e[16].v.onChange)&&e[16].v.onChange.apply(this,arguments)}),L(H,"click",ge),L(t,"toggle",Ae),L(t,"click",ye)],q=!0)},p(B,T){e=B,T&1&&a.value!==e[16].name&&M(a,e[16].name),T&1&&i.value!==e[16].h.value&&M(i,e[16].h.value),T&1&&o!==(o=e[16].h.error+"")&&ee(m,o),T&1&&P.value!==e[16].s.value&&M(P,e[16].s.value),T&1&&n!==(n=e[16].s.error+"")&&ee(h,n),T&1&&v.value!==e[16].v.value&&M(v,e[16].v.value),T&1&&j!==(j=e[16].v.error+"")&&ee(z,j),T&1&&(t.open=e[16].open)},d(B){B&&A(t),q=!1,Pe(te)}}}function Le(e){let t,r,a,d,l,f,_,i,u=e[0],s=[];for(let o=0;o<u.length;o+=1)s[o]=he(ce(e,u,o));return{c(){t=y("h1"),r=S("LEDS"),a=C();for(let o=0;o<s.length;o+=1)s[o].c();d=C(),l=y("button"),f=S("Add equation"),this.h()},l(o){t=O(o,"H1",{class:!0});var m=b(t);r=D(m,"LEDS"),m.forEach(A),a=U(o);for(let R=0;R<s.length;R+=1)s[R].l(o);d=U(o),l=O(o,"BUTTON",{class:!0});var c=b(l);f=D(c,"Add equation"),c.forEach(A),this.h()},h(){g(t,"class","text-5xl"),g(l,"class","text-2xl")},m(o,m){Y(o,t,m),p(t,r),Y(o,a,m);for(let c=0;c<s.length;c+=1)s[c].m(o,m);Y(o,d,m),Y(o,l,m),p(l,f),_||(i=L(l,"click",e[2]),_=!0)},p(o,[m]){if(m&11){u=o[0];let c;for(c=0;c<u.length;c+=1){const R=ce(o,u,c);s[c]?s[c].p(R,m):(s[c]=he(R),s[c].c(),s[c].m(d.parentNode,d))}for(;c<s.length;c+=1)s[c].d(1);s.length=u.length}},i:pe,o:pe,d(o){o&&A(t),o&&A(a),we(s,o),o&&A(d),o&&A(l),_=!1,i()}}}function Ne(e,t,r){let a=[],d=!1,l=!1;Te(()=>{r(0,a=JSON.parse(localStorage.getItem("equations")||"[]")),a.forEach(n=>{n.h.onChange=u(n.h,n),n.s.onChange=u(n.s,n),n.v.onChange=u(n.v,n),n.h.onChange(),n.s.onChange(),n.v.onChange()}),l=!0,r(4,d=!0)});let f=!1,_;const i=(n,h=!0)=>{if(!l||n.h.error||n.s.error||n.v.error)return;f&&(_&&clearInterval(_),_=setInterval(()=>{f||(i(n,h),clearInterval(_))},1));const I=new Uint32Array(n.h.compiledValue),V=new Uint32Array(n.s.compiledValue),F=new Uint32Array(n.v.compiledValue),v=new Uint32Array([+h]),N=new Uint32Array([k.END,0]),w=new WebSocket("ws://home.anb.codes:13655");f=!0,w.addEventListener("open",()=>{console.log("Sending..."),w.send(v.buffer),console.log(v),w.send(I.buffer),console.log(I),w.send(N.buffer),console.log(N),w.send(V.buffer),console.log(V),w.send(N.buffer),console.log(N),w.send(F.buffer),console.log(F),w.send(N.buffer),console.log(N)}),w.addEventListener("close",()=>{f=!1,console.log("closed")})},u=(n,h)=>()=>{const I=be(n.value);I.error?n.error=I.error:(n.error="",n.compiledValue=I.compiled),i(h),r(0,a)},s=()=>{const n={h:{value:"",compiledValue:[],onChange:()=>{},error:""},s:{value:"",compiledValue:[],onChange:()=>{},error:""},v:{value:"",compiledValue:[],onChange:()=>{},error:""},name:"New Equation",open:!0};n.h.onChange=u(n.h,n),n.s.onChange=u(n.s,n),n.v.onChange=u(n.v,n),a.forEach(h=>h.open=!1),a.push(n),r(0,a)},o=n=>{r(0,a=a.filter(h=>h!==n))};function m(n,h){n[h].name=this.value,r(0,a)}function c(n,h){n[h].h.value=this.value,r(0,a)}function R(n,h){n[h].s.value=this.value,r(0,a)}function J(n,h){n[h].v.value=this.value,r(0,a)}const P=n=>o(n);function Q(n,h){n[h].open=this.open,r(0,a)}const x=(n,h,I)=>{console.log(a),n.open||(i(n),a.filter(V=>V!==n).forEach(V=>V.open=!1),setTimeout(()=>r(0,h[I].open=!0,a),0),r(0,a))};return e.$$.update=()=>{e.$$.dirty&17&&d&&localStorage.setItem("equations",JSON.stringify(a))},[a,i,s,o,d,m,c,R,J,P,Q,x]}class Ce extends Oe{constructor(t){super(),Re(this,t,Ne,Le,ve,{})}}export{Ce as default};
