import{S as Ie,i as Pe,s as be,k as A,q as S,a as U,l as v,m as R,r as x,h as E,c as k,n as u,b as K,G as i,I as N,B as _e,J as Le,o as Ne,K as B,L as ae,u as oe,M as Ce}from"../../chunks/index-9a6ba6fc.js";const F={INVALID:0,SIN:1,ADD:2,SUB:3,MUL:4,DIV:5,POW:6,MOD:7,IF:8,EQ:9,GT:10,LT:11,AND:12,OR:13,VAL:14,VAR_T:15,VAR_I:16,END:17},De=F,Se=e=>e.split("").map((t,n)=>t==="("?{type:"OPEN_PARAN",rawValue:t,index:n}:t===")"?{type:"CLOSE_PARAN",rawValue:t,index:n}:t===" "?{type:"WHITESPACE",rawValue:t,index:n}:t==="+"?{type:"OPERATOR",operator:"ADD",rawValue:t,index:n}:t==="-"?{type:"OPERATOR",operator:"SUB",rawValue:t,index:n}:t==="*"?{type:"OPERATOR",operator:"MUL",rawValue:t,index:n}:t==="/"?{type:"OPERATOR",operator:"DIV",rawValue:t,index:n}:t==="%"?{type:"OPERATOR",operator:"MOD",rawValue:t,index:n}:t==="^"?{type:"OPERATOR",operator:"POW",rawValue:t,index:n}:t===">"?{type:"OPERATOR",operator:"GT",rawValue:t,index:n}:t==="<"?{type:"OPERATOR",operator:"LT",rawValue:t,index:n}:t==="="?{type:"OPERATOR",operator:"EQ",rawValue:t,index:n}:t===","?{type:"OPERATOR",operator:"SEP",rawValue:t,index:n}:t==="&"?{type:"OPERATOR",operator:"AND",rawValue:t,index:n}:t==="|"?{type:"OPERATOR",operator:"OR",rawValue:t,index:n}:{type:"LITERAL",value:t,rawValue:t,index:n}),Ee=[["SEP"],["AND","OR"],["GT","LT","EQ"],["MOD"],["ADD","SUB"],["DIV","MUL"]];class H extends Error{constructor(t,n){super(t),this.index=n}}const X=(e,t)=>{if(e.length===0)throw new H("Expected an expression",t);for(let a=0;a<Ee.length;a++){const c=Ee[a];let d=0;for(let _=0;_<e.length;_++){const o=e[_];if(o.type==="OPEN_PARAN"&&(d+=1),o.type==="CLOSE_PARAN"&&(d-=1),o.type==="OPERATOR"&&d==0&&c.includes(o.operator))return{type:"operator",op:o.operator,a:X(e.slice(0,_),e[0].index+1),b:X(e.slice(_+1),o.index+1),index:o.index}}}let n="",l=-1;for(let a=0;a<e.length;a++){const c=e[a];if(c.type==="LITERAL"&&(n+=c.value,l===-1&&(l=c.index)),c.type==="OPEN_PARAN"){if(e.slice(-1)[0].type!=="CLOSE_PARAN")throw new H("Unmatched opening parenthesis",c.index);if(n){const d=X(e.slice(a+1,-1),c.index),_=[],o=p=>{p.type==="operator"&&p.op==="SEP"?(o(p.a),o(p.b)):_.push(p)};return o(d),{type:"call",name:n,args:_,index:l}}else return X(e.slice(a+1,-1),c.index)}}const m=e.find(a=>a.type!=="LITERAL");if(m)throw new H(`Unexpected token: ${m.rawValue}`,m.index);return n=e.map(a=>a.value).join(""),isNaN(parseInt(n,10))?{type:"variable",name:n,index:e[0].index}:{type:"value",val:parseInt(n,10),index:e[0].index}},G=e=>{if(e.type==="call"){if(e.name==="if")return[...G(e.args[0]),...G(e.args[1]),...G(e.args[2]),F.IF];if(e.name==="sin")return[...G(e.args[0]),F.SIN];throw new H(`Invalid function: ${e.name}`,e.index)}else if(e.type==="operator"){const t=De[e.op];if(t===void 0)throw new H(`Invalid operator: ${e.op}`,e.index);return[...G(e.a),...G(e.b),t]}else{if(e.type==="value")return[F.VAL,e.val];if(e.type==="variable"){if(e.name==="i")return[F.VAR_I];if(e.name==="t")return[F.VAR_T];throw new H(`Unknown variable: ${e.name}`,e.index)}else throw new Error("INVALID TYPE")}},Ue=e=>{try{const t=Se(e),n=X(t.filter(m=>m.type!=="WHITESPACE"),0);return{compiled:G(n)}}catch(t){if(t instanceof H)return{error:`Error: ${t.message}
    ${e}
    ${" ".repeat(t.index)}^`,errorRaw:t};throw t}};function ge(e,t,n){const l=e.slice();return l[16]=t[n],l[17]=t,l[18]=n,l}function Ae(e){let t,n,l,m,a,c,d,_,o,p,s,g=e[16].h.error+"",f,b,D,M,Q,w,r,h,T=e[16].s.error+"",L,J,C,I,P,y,q,j,Y=e[16].v.error+"",Z,$,z,ee,te,se;function ve(){e[5].call(l,e[17],e[18])}function we(){e[6].call(o,e[17],e[18])}function ye(){e[7].call(w,e[17],e[18])}function Oe(){e[8].call(y,e[17],e[18])}function Re(){return e[9](e[16])}function Te(){e[10].call(t,e[17],e[18])}function Ve(){return e[11](e[16],e[17],e[18])}return{c(){t=A("details"),n=A("summary"),l=A("input"),m=U(),a=A("div"),c=A("div"),d=A("label"),_=S("h = "),o=A("input"),p=U(),s=A("pre"),f=S(g),b=U(),D=A("div"),M=A("label"),Q=S("s = "),w=A("input"),r=U(),h=A("pre"),L=S(T),J=U(),C=A("div"),I=A("label"),P=S("v = "),y=A("input"),q=U(),j=A("pre"),Z=S(Y),$=U(),z=A("button"),ee=S("Delete"),this.h()},l(W){t=v(W,"DETAILS",{class:!0});var O=R(t);n=v(O,"SUMMARY",{});var ue=R(n);l=v(ue,"INPUT",{type:!0,class:!0}),ue.forEach(E),m=k(O),a=v(O,"DIV",{class:!0});var V=R(a);c=v(V,"DIV",{class:!0});var re=R(c);d=v(re,"LABEL",{for:!0});var ie=R(d);_=x(ie,"h = "),ie.forEach(E),o=v(re,"INPUT",{name:!0,class:!0,type:!0,autocomplete:!0,autocorrect:!0,autocapitalize:!0,spellcheck:!0}),re.forEach(E),p=k(V),s=v(V,"PRE",{});var pe=R(s);f=x(pe,g),pe.forEach(E),b=k(V),D=v(V,"DIV",{class:!0});var ne=R(D);M=v(ne,"LABEL",{for:!0});var ce=R(M);Q=x(ce,"s = "),ce.forEach(E),w=v(ne,"INPUT",{name:!0,class:!0,type:!0,autocomplete:!0,autocorrect:!0,autocapitalize:!0,spellcheck:!0}),ne.forEach(E),r=k(V),h=v(V,"PRE",{});var fe=R(h);L=x(fe,T),fe.forEach(E),J=k(V),C=v(V,"DIV",{class:!0});var le=R(C);I=v(le,"LABEL",{for:!0});var he=R(I);P=x(he,"v = "),he.forEach(E),y=v(le,"INPUT",{name:!0,class:!0,type:!0,autocomplete:!0,autocorrect:!0,autocapitalize:!0,spellcheck:!0}),le.forEach(E),q=k(V),j=v(V,"PRE",{});var de=R(j);Z=x(de,Y),de.forEach(E),$=k(V),z=v(V,"BUTTON",{class:!0});var me=R(z);ee=x(me,"Delete"),me.forEach(E),V.forEach(E),O.forEach(E),this.h()},h(){u(l,"type","text"),u(l,"class","focus:outline-none font-mono"),u(d,"for","h"),u(o,"name","h"),u(o,"class","pl-4 font-mono focus:outline-none"),u(o,"type","text"),u(o,"autocomplete","off"),u(o,"autocorrect","off"),u(o,"autocapitalize","off"),u(o,"spellcheck","false"),u(c,"class","flex whitespace-nowrap"),u(M,"for","s"),u(w,"name","s"),u(w,"class","pl-4 font-mono focus:outline-none"),u(w,"type","text"),u(w,"autocomplete","off"),u(w,"autocorrect","off"),u(w,"autocapitalize","off"),u(w,"spellcheck","false"),u(D,"class","flex whitespace-nowrap"),u(I,"for","v"),u(y,"name","v"),u(y,"class","pl-4 font-mono focus:outline-none"),u(y,"type","text"),u(y,"autocomplete","off"),u(y,"autocorrect","off"),u(y,"autocapitalize","off"),u(y,"spellcheck","false"),u(C,"class","flex whitespace-nowrap"),u(z,"class","mt-4"),u(a,"class","pl-10"),u(t,"class","pl-10 py-5 font-mono text-2xl")},m(W,O){K(W,t,O),i(t,n),i(n,l),B(l,e[16].name),i(t,m),i(t,a),i(a,c),i(c,d),i(d,_),i(c,o),B(o,e[16].h.value),i(a,p),i(a,s),i(s,f),i(a,b),i(a,D),i(D,M),i(M,Q),i(D,w),B(w,e[16].s.value),i(a,r),i(a,h),i(h,L),i(a,J),i(a,C),i(C,I),i(I,P),i(C,y),B(y,e[16].v.value),i(a,q),i(a,j),i(j,Z),i(a,$),i(a,z),i(z,ee),t.open=e[16].open,te||(se=[N(l,"input",ve),N(o,"input",we),N(o,"input",function(){ae(e[16].h.onChange)&&e[16].h.onChange.apply(this,arguments)}),N(w,"input",ye),N(w,"input",function(){ae(e[16].s.onChange)&&e[16].s.onChange.apply(this,arguments)}),N(y,"input",Oe),N(y,"input",function(){ae(e[16].v.onChange)&&e[16].v.onChange.apply(this,arguments)}),N(z,"click",Re),N(t,"toggle",Te),N(t,"click",Ve)],te=!0)},p(W,O){e=W,O&1&&l.value!==e[16].name&&B(l,e[16].name),O&1&&o.value!==e[16].h.value&&B(o,e[16].h.value),O&1&&g!==(g=e[16].h.error+"")&&oe(f,g),O&1&&w.value!==e[16].s.value&&B(w,e[16].s.value),O&1&&T!==(T=e[16].s.error+"")&&oe(L,T),O&1&&y.value!==e[16].v.value&&B(y,e[16].v.value),O&1&&Y!==(Y=e[16].v.error+"")&&oe(Z,Y),O&1&&(t.open=e[16].open)},d(W){W&&E(t),te=!1,Ce(se)}}}function xe(e){let t,n,l,m,a,c,d,_,o=e[0],p=[];for(let s=0;s<o.length;s+=1)p[s]=Ae(ge(e,o,s));return{c(){t=A("h1"),n=S("LEDS"),l=U();for(let s=0;s<p.length;s+=1)p[s].c();m=U(),a=A("button"),c=S("Add equation"),this.h()},l(s){t=v(s,"H1",{class:!0});var g=R(t);n=x(g,"LEDS"),g.forEach(E),l=k(s);for(let b=0;b<p.length;b+=1)p[b].l(s);m=k(s),a=v(s,"BUTTON",{class:!0});var f=R(a);c=x(f,"Add equation"),f.forEach(E),this.h()},h(){u(t,"class","text-5xl"),u(a,"class","text-2xl")},m(s,g){K(s,t,g),i(t,n),K(s,l,g);for(let f=0;f<p.length;f+=1)p[f].m(s,g);K(s,m,g),K(s,a,g),i(a,c),d||(_=N(a,"click",e[2]),d=!0)},p(s,[g]){if(g&11){o=s[0];let f;for(f=0;f<o.length;f+=1){const b=ge(s,o,f);p[f]?p[f].p(b,g):(p[f]=Ae(b),p[f].c(),p[f].m(m.parentNode,m))}for(;f<p.length;f+=1)p[f].d(1);p.length=o.length}},i:_e,o:_e,d(s){s&&E(t),s&&E(l),Le(p,s),s&&E(m),s&&E(a),d=!1,_()}}}function ke(e,t,n){let l=[],m=!1,a=!1;Ne(()=>{window.location.protocol==="https:"&&(window.location.protocol="http:"),n(0,l=JSON.parse(localStorage.getItem("equations")||"[]")),l.forEach(r=>{r.h.onChange=o(r.h,r),r.s.onChange=o(r.s,r),r.v.onChange=o(r.v,r),r.h.onChange(),r.s.onChange(),r.v.onChange()}),a=!0,n(4,m=!0)});let c=!1,d;const _=(r,h=!0)=>{if(!a||r.h.error||r.s.error||r.v.error)return;c&&(d&&clearInterval(d),d=setInterval(()=>{c||(_(r,h),clearInterval(d))},1));const T=new Uint32Array(r.h.compiledValue),L=new Uint32Array(r.s.compiledValue),J=new Uint32Array(r.v.compiledValue),C=new Uint32Array([+h]),I=new Uint32Array([F.END,0]),P=new WebSocket("ws://home.anb.codes:13655");c=!0,P.addEventListener("open",()=>{console.log("Sending..."),P.send(C.buffer),console.log(C),P.send(T.buffer),console.log(T),P.send(I.buffer),console.log(I),P.send(L.buffer),console.log(L),P.send(I.buffer),console.log(I),P.send(J.buffer),console.log(J),P.send(I.buffer),console.log(I)}),P.addEventListener("close",()=>{c=!1,console.log("closed")})},o=(r,h)=>()=>{const T=Ue(r.value);T.error?r.error=T.error:(r.error="",r.compiledValue=T.compiled),_(h),n(0,l)},p=()=>{const r={h:{value:"",compiledValue:[],onChange:()=>{},error:""},s:{value:"",compiledValue:[],onChange:()=>{},error:""},v:{value:"",compiledValue:[],onChange:()=>{},error:""},name:"New Equation",open:!0};r.h.onChange=o(r.h,r),r.s.onChange=o(r.s,r),r.v.onChange=o(r.v,r),r.h.onChange(),r.s.onChange(),r.v.onChange(),l.forEach(h=>h.open=!1),l.push(r),n(0,l)},s=r=>{n(0,l=l.filter(h=>h!==r))};function g(r,h){r[h].name=this.value,n(0,l)}function f(r,h){r[h].h.value=this.value,n(0,l)}function b(r,h){r[h].s.value=this.value,n(0,l)}function D(r,h){r[h].v.value=this.value,n(0,l)}const M=r=>s(r);function Q(r,h){r[h].open=this.open,n(0,l)}const w=(r,h,T)=>{console.log(l),r.open||(_(r),l.filter(L=>L!==r).forEach(L=>L.open=!1),setTimeout(()=>n(0,h[T].open=!0,l),0),n(0,l))};return e.$$.update=()=>{e.$$.dirty&17&&m&&localStorage.setItem("equations",JSON.stringify(l))},[l,_,p,s,m,g,f,b,D,M,Q,w]}class Be extends Ie{constructor(t){super(),Pe(this,t,ke,xe,be,{})}}export{Be as default};
